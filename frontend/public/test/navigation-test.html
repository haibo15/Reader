<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¯¼èˆªåŠŸèƒ½æµ‹è¯•</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f5f5f5;
        }
        .test-section {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .test-button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        .test-button:hover {
            background: #0056b3;
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
        }
        .status.success { background: #d4edda; color: #155724; }
        .status.error { background: #f8d7da; color: #721c24; }
        .status.info { background: #d1ecf1; color: #0c5460; }
    </style>
</head>
<body>
    <h1>ğŸ§ª å¯¼èˆªåŠŸèƒ½æµ‹è¯•</h1>
    
    <div class="test-section">
        <h2>æµ‹è¯•é¡¹ç›®</h2>
        <p>è¿™ä¸ªé¡µé¢ç”¨äºæµ‹è¯•æ–°è®¾è®¡çš„å¯¼èˆªåŠŸèƒ½æ˜¯å¦æ­£å¸¸å·¥ä½œã€‚</p>
        
        <button class="test-button" onclick="testNavigation()">æµ‹è¯•å¯¼èˆªåˆ‡æ¢</button>
        <button class="test-button" onclick="testDocumentHistory()">æµ‹è¯•æ–‡æ¡£å†å²</button>
        <button class="test-button" onclick="testFileDisplay()">æµ‹è¯•æ–‡ä»¶æ˜¾ç¤º</button>
        
        <div id="testResults"></div>
    </div>

    <script>
        // æ¨¡æ‹Ÿé…ç½®
        const CONFIG = {
            API_BASE_URL: 'http://localhost:5000/api'
        };

        // æ¨¡æ‹Ÿå…¨å±€å˜é‡
        let currentFileId = null;
        let currentChapters = [];
        let audioFiles = [];

        // æ¨¡æ‹ŸAppç±»
        class App {
            static switchSection(sectionName) {
                showStatus(`åˆ‡æ¢åˆ°æ¿å—: ${sectionName}`, 'success');
                return true;
            }
        }

        // æ¨¡æ‹ŸUtilsç±»
        class Utils {
            static showStatus(message, type = 'info') {
                showStatus(message, type);
            }
        }

        // æ¨¡æ‹ŸDocumentHistoryç±»
        class DocumentHistory {
            static async showDocumentHistory() {
                try {
                    showStatus('æ­£åœ¨åŠ è½½æ–‡æ¡£å†å²...', 'info');
                    
                    // æ¨¡æ‹ŸAPIè°ƒç”¨
                    await new Promise(resolve => setTimeout(resolve, 1000));
                    
                    // æ¨¡æ‹ŸæˆåŠŸå“åº”
                    const mockDocuments = [
                        {
                            file_id: 'test-123',
                            original_name: 'æµ‹è¯•æ–‡æ¡£.pdf',
                            upload_time: Date.now() / 1000,
                            file_size: 1024 * 1024,
                            chapter_count: 5,
                            audio_count: 3,
                            has_audio: true
                        }
                    ];
                    
                    DocumentHistory.displayHistory(mockDocuments);
                    showStatus('æ–‡æ¡£å†å²åŠ è½½æˆåŠŸ', 'success');
                    
                } catch (error) {
                    showStatus(`åŠ è½½æ–‡æ¡£å†å²å¤±è´¥: ${error.message}`, 'error');
                }
            }

            static displayHistory(documents) {
                const resultsDiv = document.getElementById('testResults');
                resultsDiv.innerHTML = '<h3>ğŸ“š æ¨¡æ‹Ÿæ–‡æ¡£å†å²</h3>';
                
                documents.forEach(doc => {
                    const docDiv = document.createElement('div');
                    docDiv.style.cssText = 'border: 1px solid #ddd; padding: 15px; margin: 10px 0; border-radius: 5px;';
                    docDiv.innerHTML = `
                        <h4>${doc.original_name}</h4>
                        <p>æ–‡ä»¶ID: ${doc.file_id}</p>
                        <p>ç« èŠ‚æ•°: ${doc.chapter_count}</p>
                        <p>éŸ³é¢‘æ–‡ä»¶: ${doc.audio_count} ä¸ª</p>
                        <button class="test-button" onclick="DocumentHistory.loadDocument('${doc.file_id}')">
                            åŠ è½½æ–‡æ¡£
                        </button>
                    `;
                    resultsDiv.appendChild(docDiv);
                });
            }

            static async loadDocument(fileId) {
                try {
                    showStatus('æ­£åœ¨åŠ è½½æ–‡æ¡£...', 'info');
                    
                    // æ¨¡æ‹ŸAPIè°ƒç”¨
                    await new Promise(resolve => setTimeout(resolve, 1000));
                    
                    // æ¨¡æ‹ŸæˆåŠŸå“åº”
                    const mockResult = {
                        file_id: fileId,
                        display_name: 'æµ‹è¯•æ–‡æ¡£.pdf',
                        chapters: [
                            { title: 'ç¬¬ä¸€ç«  å¼•è¨€', content: 'è¿™æ˜¯ç¬¬ä¸€ç« çš„å†…å®¹...' },
                            { title: 'ç¬¬äºŒç«  æ­£æ–‡', content: 'è¿™æ˜¯ç¬¬äºŒç« çš„å†…å®¹...' }
                        ],
                        total_chapters: 2,
                        audio_files: []
                    };
                    
                    // è®¾ç½®å½“å‰æ–‡æ¡£ä¿¡æ¯
                    currentFileId = mockResult.file_id;
                    currentChapters = mockResult.chapters;
                    
                    // æ˜¾ç¤ºæ–‡æ¡£ä¿¡æ¯
                    FileDisplay.displayFileInfo(mockResult);
                    FileDisplay.displayChapters(mockResult.chapters);
                    
                    // è‡ªåŠ¨åˆ‡æ¢åˆ°éŸ³é¢‘ç®¡ç†æ¿å—
                    setTimeout(() => {
                        App.switchSection('audio');
                        showStatus('æ–‡æ¡£åŠ è½½æˆåŠŸï¼å·²åˆ‡æ¢åˆ°éŸ³é¢‘ç®¡ç†æ¿å—', 'success');
                    }, 500);
                    
                } catch (error) {
                    showStatus(`åŠ è½½æ–‡æ¡£å¤±è´¥: ${error.message}`, 'error');
                }
            }
        }

        // æ¨¡æ‹ŸFileDisplayç±»
        class FileDisplay {
            static displayFileInfo(result) {
                showStatus(`æ˜¾ç¤ºæ–‡ä»¶ä¿¡æ¯: ${result.display_name}`, 'success');
            }

            static displayChapters(chapters) {
                showStatus(`æ˜¾ç¤ºç« èŠ‚åˆ—è¡¨: ${chapters.length} ä¸ªç« èŠ‚`, 'success');
            }
        }

        // æµ‹è¯•å‡½æ•°
        function testNavigation() {
            showStatus('å¼€å§‹æµ‹è¯•å¯¼èˆªåŠŸèƒ½...', 'info');
            
            // æµ‹è¯•æ¿å—åˆ‡æ¢
            const sections = ['upload', 'history', 'audio'];
            sections.forEach((section, index) => {
                setTimeout(() => {
                    App.switchSection(section);
                }, index * 500);
            });
            
            showStatus('å¯¼èˆªæµ‹è¯•å®Œæˆ', 'success');
        }

        function testDocumentHistory() {
            showStatus('å¼€å§‹æµ‹è¯•æ–‡æ¡£å†å²åŠŸèƒ½...', 'info');
            DocumentHistory.showDocumentHistory();
        }

        function testFileDisplay() {
            showStatus('å¼€å§‹æµ‹è¯•æ–‡ä»¶æ˜¾ç¤ºåŠŸèƒ½...', 'info');
            
            const mockResult = {
                file_id: 'test-display',
                filename: 'æµ‹è¯•æ˜¾ç¤º.pdf',
                total_chapters: 3
            };
            
            FileDisplay.displayFileInfo(mockResult);
            
            const mockChapters = [
                { title: 'æµ‹è¯•ç« èŠ‚1', content: 'å†…å®¹1' },
                { title: 'æµ‹è¯•ç« èŠ‚2', content: 'å†…å®¹2' }
            ];
            
            FileDisplay.displayChapters(mockChapters);
        }

        // æ˜¾ç¤ºçŠ¶æ€ä¿¡æ¯
        function showStatus(message, type = 'info') {
            const resultsDiv = document.getElementById('testResults');
            const statusDiv = document.createElement('div');
            statusDiv.className = `status ${type}`;
            statusDiv.textContent = message;
            resultsDiv.appendChild(statusDiv);
            
            // è‡ªåŠ¨æ»šåŠ¨åˆ°åº•éƒ¨
            resultsDiv.scrollTop = resultsDiv.scrollHeight;
        }

        // é¡µé¢åŠ è½½å®Œæˆåæ˜¾ç¤ºæ¬¢è¿ä¿¡æ¯
        document.addEventListener('DOMContentLoaded', function() {
            showStatus('ğŸš€ æµ‹è¯•é¡µé¢åŠ è½½å®Œæˆï¼ç‚¹å‡»ä¸Šæ–¹æŒ‰é’®å¼€å§‹æµ‹è¯•ã€‚', 'info');
        });
    </script>
</body>
</html>
